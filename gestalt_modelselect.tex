\documentclass{paper}
\usepackage{amsmath}
\usepackage{amssymb}
\DeclareMathOperator*{\argmin}{arg\,min}

\begin{document}

\title{Model selection for the gestalt model}
\maketitle

\section{Approximating the likelihood}

In order to evaluate the log-likelihood for cross validation steps, we have to use an approximation.

\begin{equation}
\begin{split}
p(X \mid C_{1..k}) = \prod_{n=1}^N \iiint_{-\infty}^{\infty} p(x_n \mid v_n,z_n) p(v_n \mid g_n) p(g_n) p(z_n) \mathrm{d}v_n\mathrm{d}g_n\mathrm{d}z_n = \\
= \prod_{n=1}^N \iint_{-\infty}^{\infty}  p(g_n) p(z_n) \int_{-\infty}^{\infty} p(x_n \mid v_n,z_n) p(v_n \mid g_n) \mathrm{d}v_n\mathrm{d}g_n \mathrm{d}z_n
\end{split}
\end{equation}
%
where the double integral may be approximated by averaging over samples from $p(g)$ and $p(z)$

\begin{equation}
p(X \mid C_{1..k}) \approx \prod_{n=1}^N \frac{1}{L_1 L_2} \sum_{l_1=1}^{L_1} \sum_{l_2=1}^{L_2}  \int_{-\infty}^{\infty} p(x_n \mid v,z^{l_2}) p(v \mid g^{l_1}) \mathrm{d}v
\end{equation}
% 
and as samples of $g$ and $z$ are independent from each other we can set $L=L_1L_2$, and thus

\begin{equation}
\begin{split}
p(X \mid C_{1..k}) \approx \prod_{n=1}^N \frac{1}{L} \sum_{l=1}^L \int_{-\infty}^{\infty} p(x_n \mid v,z^l) p(v \mid g^l) \mathrm{d}v
\end{split}
\end{equation}

\end{document}
